<html>

<head>
    <title>Word Helper</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="styles.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <nav class="navbar navbar-light bg-light">
            <a class="navbar-brand">Word Helper</a>
            <div class="form-check form-switch form-control-lg">
                <input class="form-check-input" type="checkbox" role="switch" id="acentos">
                <label class="form-check-label" for="acentos">Usar acentos</label>
            </div>
            <form class="form-inline form-control-lg">
                <label class="form-control-label" for="wlen">Longitud Palabra</label>
                <select class="form-select" aria-label="Default select example" id="wlen">
                    <option value="2">2 letras</option>
                    <option value="3">3 letras</option>
                    <option value="4">4 letras</option>
                    <option selected value="5">5 letras</option>
                    <option value="6">6 letras</option>
                    <option value="7">7 letras</option>
                    <option value="8">8 letras</option>
                    <option value="9">9 letras</option>
                    <option value="10">10 letras</option>
                    <option value="11">11 letras</option>
                    <option value="12">12 letras</option>
                    <option value="13">13 letras</option>
                    <option value="14">14 letras</option>
                    <option value="15">15 letras</option>
                    <option value="16">16 letras</option>
                </select>
            </form>
        </nav>
    </div>
    <div class="container text-center">
        <div class="row" id="letras_cont">
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>

        var palabras
        const $word_len = document.getElementById("wlen")
        const $letras_cont = document.getElementById("letras_cont")
        const $acentos = document.getElementById("acentos")
        var wlen = parseInt($word_len.value)
        var acentos = $acentos.checked
        var palabra = ""

        create_letras(letras_cont, wlen)

        function create_letras(c, l) {
            //remove all elements
            while (c.firstChild) {
                c.removeChild(c.lastChild)
            }
            //AÃ±ade un elemento por cada letra
            for (let i = 0; i < l; i++) {
                but = document.createElement("button")
                but.setAttribute("type", "button")
                but.setAttribute("id", "letra_" + i)
                but.setAttribute("onkeydown", "tecla(event, " + i + ")")
                but.classList.add("btn")
                but.classList.add("btn-outline-dark")
                but.classList.add("align-middle")
                but.classList.add("letras")
                but.appendChild(document.createTextNode(" "))
                div = document.createElement("div")
                div.classList.add("col")
                div.appendChild(but)
                c.appendChild(div)
                palabra = palabra + "."
            }
        }

        function loadData(len) {
            prefix = (len < 10 ? "0" + len : len)
            var filename = "length/" + prefix + ".txt"
            var reader = new FileReader()
            reader.onload = function (e) {
                var contents = e.target.result;
                return contents;
            }
            reader.readAsText(filename)
        }

        function tecla(e, t) {
            if (e.which == 8) { // Pressed Delete
                document.getElementById("letra_" + t).innerText = ""
                palabra = palabra.replaceAt(t, ".")
            } else {
                pulsada = String.fromCharCode(e.which).toLowerCase()
                if (!acentos) { //No se permiten acentos
                    if (pulsada >= 'a' && pulsada <= 'z') {
                        document.getElementById("letra_" + t).innerText = pulsada
                        palabra = palabra.replaceAt(t, pulsada)
                    }
                }
            }
            console.log(palabra)
        }

        $word_len.addEventListener('change', function () {
            palabra = ""
            wlen = parseInt($word_len.value)
            create_letras(letras_cont, wlen)
        })

        String.prototype.replaceAt = function (index, replacement) {
            return this.substring(0, index) + replacement + this.substring(index + replacement.length);
        }

        async function decompressBlob(blob) {
            let ds = new DecompressionStream("gzip");
            let decompressedStream = blob.stream().pipeThrough(ds);
            return await new Response(decompressedStream).blob();
        }

    </script>
</body>

</html>